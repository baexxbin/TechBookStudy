# 테스트 피라미드

단위 테스트 -> 통합 테스트 -> E2E 테스트 (가까워질수록 사용자와 가까운 기능)

**단위 테스트**

가장 작은 단위를 검증하는 테스트. Unit이란 통상적으로 함수, 메서드, 클래스같은 개별적이고 작은 코드 조각을 지칭.

따라서 단위테스트란 객체나 컴포넌트에 할당된 작은 책임 하나가 예상대로 동작하는지 확인하는 테스트

단위테스트가 가장 많이 작성되어야한다.

**통합 테스트**

통합 테스트는 여러 컴포넌트나 객체가 협력하는 상황을 검증하는 테스트. 즉, 통합테스트는 독립적으로 만들었던 객체들이 상호작용하면서 생길수 있는 상황을 검증

객체지향 관점으로는 객체간의 협력을 평가. 애플리케이션 관점으로는 비즈니스 프로세스의 흐름을 검사하는 테스트

**E2E 테스트**
실제 사용자 시나리오에서 시스템이 어떻게 동작하는지 검증하는 테스트

백엔드 개발자 입장에서 E2E테스트는 API테스트라고 불리기도함.

## 구글의 테스트 피라미드

단위, 통합, E2E의 범위는 모호하다. 조금 더 명확한 모델을 위해 구글의 테스트 피라미드를 활용해보자

<img src="https://github.com/user-attachments/assets/23db8a29-c3ea-4660-8012-35ed821c2e0b" width="350">

1. 소형 테스트: 단일 서버, 단일 프로세스, 단일 스레드에서 동작하며, 디스크 I/O, 블록킹 호출이 없는 테스트를 의미
2. 중형 테스트: 단일 서버에서 동작하되 멀티 프로세스, 멀티 스레드를 사용할 수 있는 테스트
3. 대형 테스트: 멀티 서버에서 동작하는 테스트

이를 표로 나타내면 다음과 같다.

<img src="https://github.com/user-attachments/assets/5afd47ee-5b7c-47a3-b199-bdb1948d1984" width=350>

뒤에서 더 자세히 알아보자

## 테스트 분류 기준
구글이 테스트를 구분짓는 특징은 '결정성'과 '속도'입니다.

결정성: 테스트는 일관돼야 한다. -> 같은 코드를 대상으로 실행하는 테스트는 항상 같은 응답을 해야한다는 의미

ex) 아침에는 성공하고, 저녁에는 실패하는 테스트->비결정형 테스트

상황뿐만 아닌 외부적인 요인(DB, 네트워크 등)에 의해서도 비결정형 테스트가 될수 있다. 가능한 결정적으로 테스트를 만들어야한다.

속도: 테스트를 실행했을 때 테스트의 성공, 실패 여부를 빠르게 확인할 수 있어야합니다.
ex) 스프링 컨텍스트를 실행함으로 인해 속도의 차이가 발생할 수 있다. (ps.테스트 환경을 통합하여 해결하능)

테스트가 비결정적이고, 속도가 느려지는 상황

> 비결정적인 테스트가 만들어지는 이유
> 1. 테스트가 병렬처리를 사용할 경우
> 2. 테스트가 디스크 I/O를 사용할 경우
> 3. 테스트가 다른 프로세스와 통신할 경우
> 4. 테스트가 외부 서버와 통신할 경우

> 속도가 느린 테스트가 만들어지는 이유
> 1. 테스트가 블로킹 호출을 사용할 경우
> 2. 테스트가 디스크 I/O를 사용할 경우
> 3. 테스트가 다른 프로세스와 통신할 경우
> 4. 테스트가 외부 서버와 통신할 경우


## 소형 테스트의 중요성
기억해둘만한 인사이트
> 1. 시스템에는 소형 테스트가 많아야한다.
> 2. 중형 테스트나 대형 테스트가 소형 테스트보다 많아지는것은 바람직하지 않다.
> 3. 소형 테스트는 단일 스레드, 단일 프로세스, 단일 서버에서 실행되며, 디스크 I/O, 블로킹 호출이 없는 테스트입니다.
> 4. H2를 이용한 테스트는 중형 테스트 입니다.


