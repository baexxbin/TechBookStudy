# 13장 : 테스트 피라미드

- 테스트 분류
    - 테스트 피라미드
        - E2E테스트 (가장 꼭대기)
            - 실제 사용자 시나리오 시스템이 어떻게 동작하는지 검증
                - 가장 위일 수록 사용자 실제 환경에 가까움
                - API테스트, UI테스트라고도 표기
            - 하위 컴포넌트와 레이어 사이 상호작용 확인 가능
                - 하위시스템 모두 통합시 생길 수 있는 문제 찾기 가능
        - 통합 테스트
            - 여러 컴포넌트나 객체가 협력하는 상황 검증 테스트
                - 객체지향 관점 → 객체들의 협력이 제대로 이뤄지는지 평가
                - 애플리케이션 서비스 관점 → 비즈니스 프로세스의 흐름 검사
            - 서로 다른 모듈이나 시스템 간 인터페이스 테스트
                - 연동 시스템 장애, 예외 상황 발생시 시스템 반응 테스트
        - 단위 테스트 (가장 아래)(가장 중요)
            - 소프트웨어 구성 가장 작은 단위 검증 테스트
                - 객체나 컴포넌트에 할당된 작은 책임 동작 확인
        - 각 계층의 면적은 테스트의 비율과 선행 관계 나타냄
    
    > 피라미드 테스트의 각 의미가 구분이 모호함
    > 
    
    - 구글의 테스트 피라미드
        - 대형 테스트
            - 단일 서버, 프로세스, 스레드 동작
            - 디스크 I/O, 블로킹 호출이 없는 테스트
        - 중형 테스트
            - 단일 서버 동작하되, 멀티 프로세스, 스레드 사용 가능
        - 소형 테스트
            - 멀티 서비스 동작

<br>

### 13.2 : 테스트 분류 기준

- (구글의) 테스트 분류 기준
    - 결정성
        - 테스트는 일관돼야함
        - EX)H2이용 테스트는 비결정적
        - 비결정적이게 되는 원인
            - 병렬 처리 → 실행 순서 보장X
            - 디스크I/O
            - 다른 프로세스 및 외부 서버와 통신 → 통신 시 문제
    - 속도
        - 느려지는 원인
            - 블로킹 호출
            - 디스크I/O
            - 다른 프로세스 및 외부 서버와 통신

<br>

### 13.3: 소형 테스트의 중요성

- 테스트 관련 인사이트
    - 시스템엔 소형 테스트가 많아야함(비율적으로도)
    - H2는 중형 테스트

- 소형 시스템 중요
    - 트랜잭션 스크립트 나올 확률 줄어듦
        - 트랜잭션 스크립트가 갖고있던 비즈니스 로직을 도메인으로 옮겨 도메인을 테스트
        - 능동적 도메인으로 외부 간섭없이 테스트 가능
        
        ⇒ 소형 테스트에 집중하면 도메인에 비즈니스 로직을 넣게 됨
        

> 소형, 중형, 대형 테스트는 어느 부분을 테스트하느냐보다 > 어떻게 테스트 하느냐에 따라 결정됨 ⇒ 테스트 대역 사용