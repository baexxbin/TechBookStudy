### 14ì¥ í…ŒìŠ¤íŠ¸ ëŒ€ì—­

- í…ŒìŠ¤íŠ¸ ëŒ€ì—­ì´ë€, ì˜í™”ì— ë‚˜ì˜¤ëŠ” ìŠ¤í„´íŠ¸ë§¨(ëŒ€ì—­)ì²˜ëŸ¼ ì‹¤ì œ ê°ì²´ë¥¼ ëŒ€ì‹ í•˜ëŠ” ê°ì²´ë¥¼ ì˜ë¯¸í•¨.

| ìœ í˜•  | ì„¤ëª…                                                     |
| :---- | :------------------------------------------------------- |
| Dummy | ì•„ë¬´ëŸ° ê¸°ëŠ¥ì´ ì—†ìŒ.                                      |
| Stub  | íŠ¹ì •í•œ ìƒí™©ì— ëŒ€í•´ ë¯¸ë¦¬ ì •í•´ì§„ ê²°ê³¼ë¥¼ ë°˜í™˜í•¨.            |
| Fake  | ìì²´ì ì¸ ë¡œì§ì´ ìˆìŒ.                                    |
| Mock  | ì•„ë¬´ëŸ° ë™ì‘ì„ í•˜ì§€ ì•Šì§€ë§Œ ì–´ë–¤ í–‰ë™ì´ í˜¸ì¶œëëŠ”ì§€ ê¸°ë¡í•¨. |
| Spy   | ì‹¤ì œ ê°ì²´ë¥¼ ëŒ€ì‹ í•˜ë©´ì„œ í˜¸ì¶œëœ í–‰ë™ì„ ê¸°ë¡í•¨.             |

#### Dummy

- ì•„ë¬´ëŸ° ë™ì‘ë„ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ” ê°ì²´.
- ì•„ë˜ì™€ ê°™ì´ SomethingFilterë¥¼ êµ¬í˜„í•´ì„œ í…ŒìŠ¤íŠ¸ í•œë‹¤ê³  ê°€ì •í•¨.
  - í…ŒìŠ¤íŠ¸ ëª©í‘œëŠ” giveMe attributeê°€ textì¸ ê²½ìš° ì‘ë‹µì˜ Content-Typeì„ text/plainìœ¼ë¡œ ë³€ê²½í•˜ëŠ” ê²ƒ.
  - í•˜ì§€ë§Œ filterChainì˜ ì—­í• ì€ ì•„ë¬´ê²ƒë„ ì—†ëŠ”ë° ê·¸ëŸ¼ì—ë„ filterChainì€ ë„£ì–´ì¤˜ì•¼ í•¨.
  - ì´ëŸ´ ê²½ìš° filterChainì„ **Dummyë¡œ ëŒ€ì²´**í•  ìˆ˜ ìˆìŒ.

```java filename="" copy showLineNumbers {24-28}
public class SomethingFilter extends GenericFilterBean {
  @Override
  public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) {
    // textë¥¼ ìš”ì²­í•˜ëŠ” requestë¼ë©´ ì‘ë‹µì˜ Content-Typeì„ text/plainìœ¼ë¡œ ë³€ê²½
    if (request.getAttribute("giveMe").equals("text")) {
      response.setContentType("text/plain");
    }

    // ì±…ì„ ì—°ì‡„ íŒ¨í„´ì— ë”°ë¼ ë‹¤ìŒ í•„í„°ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ í•„í„° ì²´ì¸ì˜ doFilterë¥¼ í˜¸ì¶œ
    chain.doFilter(request, response);
  }
}

@Test
public void ìš”ì²­ì—_textë¡œ_ë‹¬ë¼ëŠ”_ìš”ì²­ì´_ìˆìœ¼ë©´_ì‘ë‹µì˜_ì½˜í…ì¸ _íƒ€ì…ì€_text_plainì´ì–´ì•¼_í•¨() {
  // given
  ServletRequest request = new MockHttpServletRequest();
  request.setAttribute("giveMe", "text");
  ServletResponse response = new MockHttpServletResponse();

  // when
  SomethingFilter filter = new SomethingFilter();
  filter.doFilter(request, response,
    new FilterChain(
      @Override
      public void doFilter(ServletRequest request, ServletResponse response) {
        // do nothing
      })
    );

  // then
  assertThat(response.getContentType()).isEqualTo("text/plain");
}
```

- ìœ„ì™€ ê°™ì´ Dummyë¡œ ìƒì„±ëœ FilterChainì€ ì•„ë¬´ëŸ° ë™ì‘ì„ í•˜ì§€ ì•Šì§€ë§Œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê²°ê³¼ì—ëŠ” ì˜í–¥ì´ ì—†ìŒ.

#### Stub

- **Stub**ì€ 'ë¶€ë³¸', 'ì§§ì€ ë¶€ë¶„'ì´ë¼ëŠ” ëœ»ì´ ìˆìŒ.
- ì›ë³¸ê³¼ ë¹„ìŠ·í•˜ê²Œ ë§Œë“¤ì–´ ì°¸ê³ ë¡œ ë³´ê´€í•˜ëŠ” ì„œë¥˜ë¥¼ ëœ»í•˜ëŠ” ë§.
- ì‘ë‹µì„ ìµœëŒ€í•œ ë¹„ìŠ·í•˜ê²Œ ë§Œë“¤ì–´ ì°¸ê³ ë¡œ ì‚¬ìš©í•˜ëŠ” ê°ì²´.

```java filename="" copy showLineNumbers
@RequiredArgsConstructor
public class UserService {
  private final UserRepository userRepository;
  public User register(UserCreateDto userCreateDto) {
    if(userRepository.findByEmail(userCreate.getEmail()).isPresent()) {
      throw new DuplicatedException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤.");
    }
    ...
  }
}
```

- ìœ„ì™€ ê°™ì€ ì½”ë“œë¥¼ í…ŒìŠ¤íŠ¸í•œë‹¤ê³  ê°€ì •í•  ë•Œ, ì•„ë˜ì™€ ê°™ì´ Stubì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ.

```java filename="" copy showLineNumbers
class StubExistUserRepository implements UserRepository {
  @Override
  public Optional<User> findByEmail(String email) {
    return Optional.of(User.builder()
      .id(1L)
      .email(email)
      .nickname("nickname")
      .build());
  }
}

class StubEmptyUserRepository implements UserRepository {
  @Override
  public Optional<User> findByEmail(String email) {
    return Optional.empty();
  }
}
```

- ê·¸ë¦¬ê³  ìœ„ Stubì„ Injection í•´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  ìˆ˜ ìˆìŒ.

#### Fake

- ìì²´ì ì¸ ë¡œì§ì„ ê°–ê³  ìˆëŠ” ê°ì²´.
- ì˜ˆë¥¼ ë“¤ë©´ ìœ„ì—ì„œëŠ” `UserRepository`ì˜ íŠ¹ì •í•œ ì…ë ¥ì— ëŒ€í•œ íŠ¹ì •í•œ ë°˜í™˜ì„ í–ˆë‹¤ë©´ **Fake**ì€ UserRepositoryì˜ ë¡œì§ì„ ì§ì ‘ êµ¬í˜„í•œ ê°ì²´ë¥¼ ì˜ë¯¸í•¨.

```java filename="" copy showLineNumbers
public class FakeUserRepository implements UserRepository {
  private final long autoGeneratedId = 0L;
  private final List<User> data = new ArrayList<>();

  @Override
  public Optional<User> findByEmail(String email) {
    return data.stream()
      .filter(user -> user.getEmail().equals(email))
      .findFirst();
  }

  @Override
  public User save(User user) {
    if(user.getId() == null || user.getId() == 0) {
      // create ë™ì‘
    } else {
      // update ë™ì‘
    }
    return user;
  }
}
```

#### Mock

- ì•„ë¬´ëŸ° ê¸°ëŠ¥ë„ ì•ˆí•˜ì§€ë§Œ ì£¼ë¡œ ë©”ì„œë“œ í˜¸ì¶œì´ ë°œìƒí–ˆëŠ”ì§€ ì—¬ë¶€ë¥¼ ê²€ì¦.

```java filename="" copy showLineNumbers
public class MockVerificationEmailSender implements EmailSender {
  private boolean called = false;

  @Override
  public void send(Email email) {
    called = true;
  }

  public boolean isCalled() {
    return called;
  }
}
```

#### Spy

- ì–´ë–¤ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ê³  ì´ë²¤íŠ¸ê°€ ëª‡ ë²ˆ ë°œìƒí–ˆëŠ”ì§€ í™•ì¸í•  ë•Œ ì‚¬ìš©.

```java filename="" copy showLineNumbers
public class SpyUserRepository extends UserRepository{
  private int findByEmailCall = 0;
  private int saveCall = 0;

  @Override
  public Optional<User> findByEmail(String email) {
    findByEmailCall++;
    return super.findByEmail(email);
  }

  @Override
  public User save(User user) {
    saveCall++;
    return super.save(user);
  }
}
```

- ë˜ëŠ” UserRepositoryë¥¼ implementsí•˜ê³  JpaUserRepositoryë¥¼ ì£¼ì…ë°›ì•„ì„œ êµ¬í˜„í•  ìˆ˜ë„ ìˆìŒ.

```java filename="" copy showLineNumbers
public class SpyUserRepository implements UserRepository {
  private final UserRepository userRepository;
  private int findByEmailCall = 0;
  private int saveCall = 0;

  public SpyUserRepository(UserRepository userRepository) {
    this.userRepository = userRepository;
  }

  @Override
  public Optional<User> findByEmail(String email) {
    findByEmailCall++;
    return userRepository.findByEmail(email);
  }

  @Override
  public User save(User user) {
    saveCall++;
    return userRepository.save(user);
  }
}
```

#### ìƒíƒœê¸°ë°˜ ê²€ì¦ & í–‰ìœ„ê¸°ë°˜ ê²€ì¦

- ìƒíƒœê¸°ë°˜ ê²€ì¦
  - í…ŒìŠ¤íŠ¸ ëŒ€ìƒì˜ ìƒíƒœê°€ ì–´ë–»ê²Œ ë³€í™”í•˜ëŠ”ì§€ ê²€ì¦í•˜ëŠ” ë°©ë²•.
- í–‰ìœ„ê¸°ë°˜ ê²€ì¦
  - í…ŒìŠ¤íŠ¸ì˜ ê²€ì¦ ë™ì‘ì— ë©”ì„œë“œ í˜¸ì¶œ ì—¬ë¶€ë¥¼ ë³´ê²Œí•˜ëŠ” ë°©ë²•.
- ìƒíƒœê¸°ë°˜ ê²€ì¦ìœ¼ë¡œ í•˜ëŠ” í¸ì´ ì¢‹ìŒ. ğŸ‘‰ í…ŒìŠ¤íŠ¸ë¥¼ ì±…ì„ ë‹¨ìœ„ë¡œ ë³¼ ìˆ˜ ìˆê¸° ë•Œë¬¸.
- ìƒíƒœê¸°ë°˜ í…ŒìŠ¤íŠ¸ëŠ” 'ì–´ë–»ê²Œ ëª©í‘œë¥¼ ë‹¬ì„±í•´ì™”ëŠ”ê°€?'ì— ì§‘ì¤‘í•¨.

#### ê²°ë¡ 

- í…ŒìŠ¤íŠ¸ ëŒ€ì—­ì„ ì ì ˆíˆ ì‚¬ìš©í•˜ë©´ ì¤‘í˜•ìœ¼ë¡œ ë³´ì˜€ë˜ í…ŒìŠ¤íŠ¸ë¥¼ ì†Œí˜•ìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆìŒ.
- ê¸°ìˆ ì„ ìˆ™ë‹¬í•˜ê¸° ì „ì— ê¸°ë°˜ ì§€ì‹ì€ ë°˜ë“œì‹œ ìˆ™ì§€í•´ì•¼ í•¨.
  - ìë°”ê°€ ê°‘ìê¸° ë©¸ë§í•˜ë©´ jsë‚˜ pythonì˜ í…ŒìŠ¤íŒ… í”„ë ˆì„ì›¤ì„ ë‹¤ì‹œ ê³µë¶€í•´ì•¼í•¨.
  - í•˜ì§€ë§Œ í…ŒìŠ¤íŠ¸ ëŒ€ì—­ì„ ì•Œë©´ ì–´ë–¤ ì–¸ì–´ì—ì„œë„ ì‘ìš©ì´ ê°€ëŠ¥í•¨.
- ì¶”ìƒí™”ì™€ ì˜ì¡´ì„± ì—­ì „ì„ ì˜ í•´ë†”ì•¼ ëŒ€ì—­ì„ í™œìš©í•˜ê¸° ì¢€ ë” í¸í•´ì§.
